#!/bin/bash
#elaborado por sinfallas
source /usr/local/bin/variables
if ! [[ -d /lib/live/mount/rootfs ]] ; then
	echo 1 > /dev/null
else
	echo "Este programa no se puede ejecutar en modo live."
	exit 1
fi
echo $BASHPID > /run/modo-server.pid
case "$1" in
	start)
		apt -y purge task-lxde-desktop lightdm lxde lxappearance lxappearance-obconf lxde-common lxde-core lxde-icon-theme lxinput lxlauncher lxmenu-data lxmusic lxpanel lxrandr lxsession lxshortcut lxtask lxterminal brasero vlc xsane w32codecs iceweasel pidgin filezilla libreoffice xorg x11-session-utils wireshark thunar gksu fdpowermon disk-manager clamtk synaptic gparted compton evince yad plymouth gimp zenity pcmanfm
		apparmor_1
		apt -y install curl fwsnort lynx less portsentry tcpdump
		limpiar_1
		echo "## aideinit y actualizacion de firmas en psad y rkhunter ##"
		aideinit -y -f
		mv -f -v /var/lib/aide/aide.db.new /var/lib/aide/aide.db
		psad --sig-update
		psad -H
		rkhunter --update
		rkhunter --propupd
		optimizacion_1
		sed -i 's/GRUB_CMDLINE_LINUX_DEFAULT="swapaccount=1 cgroup_enable=memory disable=1 disable_ipv6=1 security=apparmor panic=10 quiet splash"/GRUB_CMDLINE_LINUX_DEFAULT="swapaccount=1 cgroup_enable=memory disable=1 disable_ipv6=1 security=apparmor panic=10 quiet"/g' /etc/default/grub
		update-grub2
		;;

	*)
		echo "Al iniciar este modo se eliminaran todos los programas que utilizan interfaz grafica,"
		echo "USO: $0 start"
		;;
esac
rm -f /run/modo-server.pid
exit 0
