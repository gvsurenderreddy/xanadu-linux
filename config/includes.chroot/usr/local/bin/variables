#!/bin/bash
#elaborado por sinfallas
if [[ $USER != root ]]; then
echo "Ejecutar como root" >&2
exit 1
fi
lock="/run/tor.lock"
lock2="/run/i2p.lock"
persistencia="/usr/local/bin/persistencia"
function espera ()
{
	sleep 30
}

function seguridad_1 ()
{
	modprobe -f ip_tables
	modprobe -f ip_conntrack
	modprobe -f iptable_filter
	modprobe -f iptable_nat
	modprobe -f ipt_physdev
	service shorewall start
	service fail2ban start
	service psad start
}

function antivirus_1 ()
{
	freshclam
	clamtk
}

function tor_1 ()
{
	echo "$(date +%d/%m/%Y-%r)" > $lock
	mv -f /etc/iceweasel/pref/iceweasel.js /etc/iceweasel/pref/iceweasel.bk
	mv -f /etc/iceweasel/pref/iceweasel.old /etc/iceweasel/pref/iceweasel.js
	service tor start
	service polipo start
	service privoxy start
	service dnsmasq restart
	tsocks -on
	service memlockd start
}

function tor_0 ()
{
	rm -f $lock
	mv -f /etc/iceweasel/pref/iceweasel.js /etc/iceweasel/pref/iceweasel.old
	mv -f /etc/iceweasel/pref/iceweasel.bk /etc/iceweasel/pref/iceweasel.js
	service privoxy stop
	service polipo stop
	service tor stop
	service dnsmasq restart
	tsocks -off
	service memlockd stop
	rm -rf /var/cache/polipo/*
}

function i2p_1 ()
{
	echo "$(date +%d/%m/%Y-%r)" > $lock2
	i2prouter start
}

function i2p_0 ()
{
	rm -f $lock2
	i2prouter stop
}

function hora_1 ()
{
	hwclock --systohc
	service ntp restart
}
